<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Downscale Function for Spatial Data — downscale • spEnviroDistr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Downscale Function for Spatial Data — downscale"><meta name="description" content="This function performs downscaling of spatial data using regression methods, including linear regression (lm), generalized linear model (glm), and geographically weighted regression (gwr).
It ensures that all input rasters have the same CRS and extent, resamples the response raster if necessary, and checks the overlap percentage between the high-resolution predictor and low-resolution predictor rasters."><meta property="og:description" content="This function performs downscaling of spatial data using regression methods, including linear regression (lm), generalized linear model (glm), and geographically weighted regression (gwr).
It ensures that all input rasters have the same CRS and extent, resamples the response raster if necessary, and checks the overlap percentage between the high-resolution predictor and low-resolution predictor rasters."><meta property="og:image" content="https://djwillichile.github.io/spEnviroDistr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spEnviroDistr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/djwillichile/spEnviroDistr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Downscale Function for Spatial Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/djwillichile/spEnviroDistr/blob/master/R/downscale.R" class="external-link"><code>R/downscale.R</code></a></small>
      <div class="d-none name"><code>downscale.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs downscaling of spatial data using regression methods, including linear regression (lm), generalized linear model (glm), and geographically weighted regression (gwr).
It ensures that all input rasters have the same CRS and extent, resamples the response raster if necessary, and checks the overlap percentage between the high-resolution predictor and low-resolution predictor rasters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">downscale</span><span class="op">(</span><span class="va">response</span>, <span class="va">pred.lr</span>, <span class="va">pred.hr</span>, method <span class="op">=</span> <span class="st">"gwr"</span>, cl <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>SpatRaster. The response variable raster (e.g., temperature) at low resolution.</p></dd>


<dt id="arg-pred-lr">pred.lr<a class="anchor" aria-label="anchor" href="#arg-pred-lr"></a></dt>
<dd><p>SpatRaster. The low-resolution predictor raster(s) (e.g., elevation at low resolution).</p></dd>


<dt id="arg-pred-hr">pred.hr<a class="anchor" aria-label="anchor" href="#arg-pred-hr"></a></dt>
<dd><p>SpatRaster. The high-resolution predictor raster(s) (e.g., elevation at high resolution) to be used for prediction.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character. The method used for downscaling. Options are "lm" for linear regression, "glm" for generalized linear model, and "gwr" for geographically weighted regression. Default is "gwr".</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>Optional. A cluster object for parallel processing. Default is NULL.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing two elements: the fitted model and the predicted high-resolution raster.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function checks that all rasters share the same CRS and extent. If the extents are not identical, it resamples the response raster to match the low-resolution predictor raster using bilinear interpolation.
It also calculates the overlap percentage between the high- and low-resolution rasters and stops execution if the overlap is less than 60%.</p>
<p>The response raster is the variable of interest at a lower resolution (e.g., temperature), while <code>pred.lr</code> and <code>pred.hr</code> are the predictors at low and high resolutions, respectively (e.g., elevation). If the method is "lm" or "glm", it fits the model using the response and low-resolution predictor raster data and returns the model and the predicted high-resolution raster. If the method is "gwr", it performs geographically weighted regression using the provided spatial data and returns the result.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load sample data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert to SpatRaster objects</span></span></span>
<span class="r-in"><span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span>   <span class="co"># Response raster (e.g., temperature)</span></span></span>
<span class="r-in"><span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span>   <span class="co"># Low-resolution predictor (e.g., elevation at low resolution)</span></span></span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>     <span class="co"># High-resolution predictor (e.g., elevation at high resolution)</span></span></span>
<span class="r-in"><span><span class="va">dem</span><span class="op">&lt;-</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">dem</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply the downscale function with GWR method</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">downscale</span><span class="op">(</span>response <span class="op">=</span> <span class="va">tavg</span>, pred.lr <span class="op">=</span> <span class="va">elev</span>, pred.hr <span class="op">=</span> <span class="va">dem</span>, method <span class="op">=</span> <span class="st">"gwr"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>[expanse] unknown CRS. Results can be wrong</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>[expanse] unknown CRS. Results can be wrong</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the model and predicted high-resolution raster</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = formula, data = data, bandwidth = bwG, adapt = adG, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     hatmatrix = TRUE, longlat = longlat, cl = cl, predictions = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive quantile: 0.005952041 (about 0 of 108 data points)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Min.    1st Qu.     Median    3rd Qu.       Max.  Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept. 13.6043186 13.8297466 13.9353450 14.0102181 14.3091637 13.8224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> altitude     -0.0053626 -0.0048709 -0.0047733 -0.0045006 -0.0036525 -0.0045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of data points: 108 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (residual: 2traceS - traceS'S): 83.43652 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (residual: 2traceS - traceS'S): 24.56348 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (residual: 2traceS - traceS'S): 0.007612498 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (model: traceS): 63.9723 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (model: traceS): 44.0277 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (model: traceS): 0.00568603 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (ML): 0.003630449 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): -573.1605 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC (GWR p. 96, eq. 4.22): -843.1112 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual sum of squares: 0.001423457 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quasi-global R2: 0.9999733 </span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="downscale-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="downscale-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Guillermo Fuentes-Jaque, Luis Morales-Salinas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

